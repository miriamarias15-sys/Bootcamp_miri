pipeline {
  agent any

  parameters {
    string(name: 'NOMBRE', defaultValue: 'Miriam Arias', description: 'Nombre que usar치 el script')
    file(name: 'FICHERO', description: 'Sube un archivo para que lo lea el script')
  }

  triggers {
    pollSCM('H/5 * * * *')   // revisa cada ~5 min y ejecuta si hay cambios en main
  }

  stages {
    stage('Info') {
      steps {
        echo "Hola, ${params.NOMBRE}"
        echo "JOB_NAME=${env.JOB_NAME}"
        echo "BUILD_NUMBER=${env.BUILD_NUMBER}"
        echo "NODE_NAME=${env.NODE_NAME}"
        echo "WORKSPACE=${env.WORKSPACE}"
      }
    }

    stage('Crear entorno virtual') {
      steps {
        sh '''
          python3 -m venv venv
          . venv/bin/activate
          python -m pip install --upgrade pip
        '''
      }
    }

    stage('Instalar requirements.txt') {
      steps {
        sh '''
          . venv/bin/activate
          pip install -r requirements.txt
        '''
      }
    }

    stage('Ejecutar script') {
  steps {
    sh '''
      . venv/bin/activate

      echo "Valor del par치metro FICHERO: '$FICHERO'"
      echo "Archivos en workspace:"
      ls -la

      if [ -n "$FICHERO" ] && [ -f "$FICHERO" ]; then
        python Python_extra.py "$NOMBRE" "$FICHERO"
      else
        echo "No se ha subido archivo (o no existe). Ejecuto sin fichero."
        python Python_extra.py "$NOMBRE"
      fi
    '''
  }
}


  }

  post {
    success {
      echo "la ejecucioon ha salido bien."
    }
    failure {
      echo " la ejecuci칩n ha fallado."
    }
    always {
      echo "Fin de la ejecuci칩n."
    }
  }
}
